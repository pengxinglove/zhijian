/*!
 * Jusfoun D3 Chart Library
 * Powered by Jusfoun Visualization Department
 * Contact: 
 *   vd@jusfoun.com
 *   http://vd.jusfoun.com
 * 
 * Copyright (c) 2016, Jusfoun Big Data Group Inc.
 * All rights reserved.
 * 
 * LICENSE
 * http://www.jusfoun.com/software/LICENSE.txt
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define("d3Charts",["d3"],e):"object"==typeof exports?exports.d3Charts=e(require("d3")):t.d3Charts=e(t.d3)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){e.MinYiYunBubble=n(1),e.MinYiYunUtil=n(2)},function(t,e){!function(t){function e(t,e){e=$.extend({},r,e),e.width=e.width||t.offsetWidth,e.height=e.height||t.offsetHeight;var i=this;i.domElement=t,i.width=e.width,i.height=e.height,i.colors=e.colors||new n(e.startColor,e.endColor,e.colorStep),e.colorFunction&&(i.colorFunction=e.colorFunction),e.weightFunction&&(i.weightFunction=e.weightFunction),e.labelFunction&&(i.labelFunction=e.labelFunction),i.clickHandler=e.clickHandler,i._force=d3.layout.force().gravity(0).charge(0).on("tick",function(t){i._force_tickHandler.bind(i)(t)}).on("end",function(t){i._tickEnd=!0,i._bubbles.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),i._option=e}function n(t,e,n){startRGB=this.colorRgb(t),startR=startRGB[0],startG=startRGB[1],startB=startRGB[2],endRGB=this.colorRgb(e),endR=endRGB[0],endG=endRGB[1],endB=endRGB[2],sR=(endR-startR)/n,sG=(endG-startG)/n,sB=(endB-startB)/n;for(var r=[],i=0;i<n;i++){var o=this.colorHex("rgb("+parseInt(sR*i+startR)+","+parseInt(sG*i+startG)+","+parseInt(sB*i+startB)+")");r.push(o)}return r}if("undefined"==typeof d3)throw new Error("Please include D3.js Library first.");var r={startColor:"",endColor:"",colorStep:6},i={left:20,right:30,top:50,bottom:20};e.prototype={constructor:e,domElement:null,minRadius:20,maxRadius:50,minFontSize:10,maxFontSize:18,colors:[],labelFunction:function(t){return t.name},weightFunction:function(t){return t.size},colorFunction:function(t){},clickHandler:null,customDrawFunction:function(t,e,n,r){t.append("circle").attr("r",n).style("fill",r).style("opacity","1")},collisionPadding:5,minCollisionRadius:30,iconPadding:150,_jitter:.618,_force:null,_svg:null,_ballGroup:null,_bubbles:null,_legend:null,_radiusScale:null,_fontSizeScale:null,_colorIndexScale:null,_width:0,_height:0,_tickEnd:!1,_data:null,init:function(){var t=this;t._width=t.width-i.right-i.left,t._height=t.height-i.top-i.bottom,t._radiusScale=d3.scale.linear().range([t.minRadius,t.maxRadius]),t._fontSizeScale=d3.scale.linear().range([t.minFontSize,t.maxFontSize]),t._colorIndexScale=d3.scale.linear().range([0,t.colors.length-1]),t._force.size([t._width,t._height]),d3.select(t.domElement).selectAll("svg").remove(),t._svg=d3.select(t.domElement).append("svg").attr("width",t.width).attr("height",t.height)},setData:function(t){var e=this;if(arguments.length<1)return e._data;e.data=t,e._data=$.extend(!0,[],t);var n=e.labelFunction||n,r=e.weightFunction||r;e._radiusScale.domain([d3.min(e._data,r),d3.max(e._data,r)]),e._fontSizeScale.domain([d3.min(e._data,r),d3.max(e._data,r)]),e._colorIndexScale.domain([d3.min(e._data,r)-1,d3.max(e._data,r)+1]),e._svg.selectAll(".node").remove(),e._ballGroup=e._svg.append("g").attr("transform","translate("+i.left+","+i.top+")").attr("class","node"),e._bubbles=e._ballGroup.selectAll("g").data(e._data).enter().append("g").style("cursor","pointer").on("click",function(t){e.clickHandler instanceof Function&&e.clickHandler.call(null,t)});var o=e.colors.length;for(e._bubbles.each(function(t){var n=r(t),i=e._radiusScale(n),a=e.colorFunction(t);if(!a){var l=Math.round(e._colorIndexScale(n));a=e.colors[o-l-1]}return e.customDrawFunction(d3.select(this),t,i,a)}),e._bubbles.append("text").attr({"text-anchor":"middle",dy:".3em"}).attr("font-size",function(t){return e._fontSizeScale(r(t))}).attr("fill","#FFFFFF").attr("font-family","微软雅黑").text(n),this._data.forEach(function(t,n){t.fr=Math.max(e.minCollisionRadius,e._radiusScale(r(t)))}),e._tickEnd=!1,e._force.nodes(this._data).start();!e._tickEnd;)e._force.tick()},resize:function(){var t=this;t.width=t.domElement.offsetWidth,t.height=t.domElement.offsetHeight,t.init(),t.setData(t.data)},_force_tickHandler:function(t){this._bubbles.each(this._gravity(.1*t.alpha)).each(this._collide(this._jitter))},_gravity:function(t){var e=this._width/2,n=this._height/2,r=t/3,i=t;return function(t){t.x+=(e-t.x)*r,t.y+=(n-t.y)*i}},_collide:function(t){var e=this._data,n=this.collisionPadding;return function(r){e.forEach(function(e){if(r!==e){var i=r.x-e.x,o=r.y-e.y,a=Math.sqrt(i*i+o*o),l=r.fr+e.fr+n;if(a<l){a=(a-l)/a*t;var c=i*a,s=o*a;r.x-=c,r.y-=s,e.x+=c,e.y+=s}}})}}},n.prototype.colorRgb=function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,t=t.toLowerCase();if(t&&e.test(t)){if(4===t.length){for(var n="#",r=1;r<4;r+=1)n+=t.slice(r,r+1).concat(t.slice(r,r+1));t=n}for(var i=[],r=1;r<7;r+=2)i.push(parseInt("0x"+t.slice(r,r+2)));return i}return t},n.prototype.colorHex=function(t){var e=t,n=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(e)){for(var r=e.replace(/(?:(|)|rgb|RGB)*/g,"").split(","),i="#",o=0;o<r.length;o++){var a=Number(r[o]).toString(16);a=a<10?"0"+a:a,"0"===a&&(a+=a),i+=a}return 7!==i.length&&(i=e),i}if(!n.test(e))return e;var l=e.replace(/#/,"").split("");if(6===l.length)return e;if(3===l.length){for(var c="#",o=0;o<l.length;o+=1)c+=l[o]+l[o];return c}},t&&(t.BubbleCloudChart=e)}(window)},function(t,e,n){var r=(n(3),{toDataUrl:function(t,e,n){if(!t||"function"!=typeof e)throw new Error("Illegal parameters.");n||(n="image/png");var r=t.getAttribute("width"),i=t.getAttribute("height");t.setAttribute("version","1.1"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xlink","http://www.w3.org/1999/xlink");var o=(new XMLSerializer).serializeToString(t),a="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(o),l=document.createElement("canvas");l.width=r,l.height=i;var c=l.getContext("2d"),s=new Image;s.onload=function(){c.drawImage(s,0,0),"function"==typeof e&&e(l.toDataURL(n))},s.src=a},_toDataUrl2:function(t,e){var n=t.getAttribute("width"),r=t.getAttribute("height");t.setAttribute("version","1.1"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xlink","http://www.w3.org/1999/xlink");var i=(new XMLSerializer).serializeToString(t),o=self.URL||self.webkitURL||self,a=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),l=o.createObjectURL(a),c=document.createElement("canvas");c.width=n,c.height=r;var s=c.getContext("2d"),d=new Image;d.onload=function(){s.drawImage(d,0,0);var t=c.toDataURL("image/png");o.revokeObjectURL(t),"function"==typeof e&&e(t)},d.src=l}});t.exports=r},function(e,n){e.exports=t}])});